import React from 'react';
import axios from "axios";
import tempimage from './components/main_image.jpg';
import Card from '@material-ui/core/Card';
import mainText from './components/rearguard.png';
import 'bootstrap/dist/css/bootstrap.css';
import CircleLoader from "react-spinners/CircleLoader";
import how from "./components/how.png";
import what from "./components/what.png";

class Frontend extends React.Component {
  constructor(props) {
    super(props);
    this.handleUploadImage = this.handleUploadImage.bind(this);
    this.renderComponent = this.renderComponent.bind(this);
    this.state = {
      returnnum:0,
      loading: false,
      returndata: '',
      youhyo: false,
      ultimateyouhyo: false,
      ddd:''
    }
  }



  //how
  try3 = () => {
    this.props.history.push('/static');
  }
  //what
  try2 = () => {
    this.props.history.push('/rearguard');
  }

  componentDidMount() {
    this.state.loading = false
    this.setState({
      returndata: '',
      ultimateyouhyo:false
    })
  }

  handleUploadImage(ev) {
    ev.preventDefault();
    const data = new FormData();
    this.fileName = ""
    data.append('file', this.uploadInput.files[0]);
    data.append('filename', this.fileName.value);
    axios.post(`http://localhost:8000/upload`, data, {
      headers: {
        'Content-Type': 'multipart/form-data',
        'Access-Control-Allow-Origin': '*'
      }
    })
      .then((response) => {
        this.setState({
          loading: false,
          returndata: response.data,
          returnnum : parseFloat(response.data),
          ultimateyouhyo : true
        })
      })
      .catch(function (error) {
        console.log(error);
        alert(error);
      });
  }

  renderComponent() {
    this.setState({
      loading: true
    })
    if (this.state.returndata === '' || this.state.returnnum===0) {
      this.state.ultimateyouhyo = false;
    }
    else 
    {
      this.setState({ ultimateyouhyo: true })
      if (this.state.ultimateyouhyo === true && this.state.returnnum <= 0.5) 
      {
        this.setState({ youhyo: true }) //정상
      }
      else if (this.state.ultimateyouhyo === true && this.state.returnnum > 0.5) 
      {
        this.setState({ youhyo: false }) //악성
      }
    }


  }

  render() {
    return (
      <form onSubmit={this.handleUploadImage}>
        <div>
          <img className="main_image" src={tempimage} ></img>
        </div>
        <div>
          <Card>
            <img src={mainText} className="rearguard" alt="maintext" />
          </Card>
        </div>
        <div className="right2">
          <div>
            <img src={what} className="what" onClick={this.try2} />
          </div>
        </div>
        <div className="right">
          <div>
            <img src={how} className="how" onClick={this.try3} />
          </div>
        </div>
        <div className="centerUpload">
          <div className="graybox">
            <div className="forspace">
              <div className="file_input_div">
                <input className = "fileInput" ref={(ref) => { this.uploadInput = ref; }} type="file"/>
              </div>
              <br/>
              <div className = "file_input_div2">
                <button className="submitButton" type="submit" onClick={this.renderComponent}>Running</button>
              </div>
            </div>
            <div className="photo"> 
              <CircleLoader size={50} color={"#123abc"} loading={this.state.loading} />
            </div>
            <div className="runningimage">
              {this.state.ultimateyouhyo ? this.state.youhyo ? `${this.state.returndata}` : `${this.state.returndata}` : `${this.state.ddd}`}
            </div>
          </div>
        </div>
      </form>
    );
  }
}
export default Frontend;